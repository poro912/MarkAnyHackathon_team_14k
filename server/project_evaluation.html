<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>프로젝트 평가</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 40px;
            background: #f8f9fa;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }

        .coming-soon {
            background: white;
            padding: 60px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }

        .coming-soon-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .coming-soon h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 28px;
        }

        .coming-soon p {
            color: #666;
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .features-preview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .feature-card {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .feature-card h3 {
            color: #333;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .feature-card h3 span {
            margin-right: 10px;
            font-size: 20px;
        }

        .feature-card p {
            color: #666;
            line-height: 1.5;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 8px;
            margin-top: 15px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea, #764ba2);
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .status {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📊 프로젝트 평가</h1>
            <p>AI 기반 코드 품질 분석 및 프로젝트 평가 도구</p>
        </div>

        <div class="coming-soon">
            <div class="coming-soon-icon">🚧</div>
            <h2>개발 중입니다</h2>
            <p>
                프로젝트 평가 기능은 현재 개발 중입니다.<br>
                곧 강력한 AI 기반 코드 분석 도구를 만나보실 수 있습니다.
            </p>
        </div>

        <!-- GitHub 분석 섹션 -->
        <div class="github-analyzer" style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 30px;">
            <h2 style="color: #333; margin-bottom: 20px; display: flex; align-items: center;">
                <span style="margin-right: 10px; font-size: 24px;">🔍</span>
                GitHub 레포지터리 분석
            </h2>
            
            <div class="add-repo" style="margin-bottom: 20px;">
                <input type="text" id="repoUrl" placeholder="GitHub 레포지터리 URL 입력 (예: https://github.com/user/repo)" 
                       style="width: 400px; padding: 12px; border: 1px solid #ddd; border-radius: 6px; margin-right: 10px; font-size: 14px;" />
                <button onclick="addRepository()" 
                        style="padding: 12px 20px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">
                    레포지터리 추가
                </button>
            </div>

            <div class="tabs" id="tabs" style="display: flex; margin-bottom: 20px; border-bottom: 1px solid #ddd;"></div>
            
            <div class="content" id="content" style="min-height: 400px;">
                <div class="loading" style="text-align: center; padding: 50px; color: #666;">
                    레포지터리를 추가하여 분석을 시작하세요
                </div>
            </div>
        </div>

        <div class="features-preview">
            <div class="feature-card">
                <h3><span>🔍</span>코드 품질 분석</h3>
                <p>코드의 복잡도, 가독성, 유지보수성을 종합적으로 분석하여 품질 점수를 제공합니다.</p>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 75%;"></div>
                </div>
                <div class="status">개발 진행률: 75%</div>
            </div>

            <div class="feature-card">
                <h3><span>🛡️</span>보안 취약점 검사</h3>
                <p>잠재적인 보안 위험 요소를 식별하고 개선 방안을 제시합니다.</p>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 60%;"></div>
                </div>
                <div class="status">개발 진행률: 60%</div>
            </div>

            <div class="feature-card">
                <h3><span>⚡</span>성능 최적화 제안</h3>
                <p>코드 성능을 분석하고 최적화 방안을 AI가 자동으로 제안합니다.</p>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 45%;"></div>
                </div>
                <div class="status">개발 진행률: 45%</div>
            </div>

            <div class="feature-card">
                <h3><span>📈</span>프로젝트 메트릭</h3>
                <p>라인 수, 함수 복잡도, 의존성 등 프로젝트의 다양한 지표를 시각화합니다.</p>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 30%;"></div>
                </div>
                <div class="status">개발 진행률: 30%</div>
            </div>

            <div class="feature-card">
                <h3><span>🎯</span>개선 로드맵</h3>
                <p>분석 결과를 바탕으로 프로젝트 개선을 위한 단계별 로드맵을 제공합니다.</p>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 20%;"></div>
                </div>
                <div class="status">개발 진행률: 20%</div>
            </div>

            <div class="feature-card">
                <h3><span>📋</span>상세 리포트</h3>
                <p>분석 결과를 PDF 또는 HTML 형태의 상세 리포트로 생성합니다.</p>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 10%;"></div>
                </div>
                <div class="status">개발 진행률: 10%</div>
            </div>
        </div>
    </div>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        let repositories = [];
        let activeRepo = null;

        function addRepository() {
            const url = document.getElementById('repoUrl').value.trim();
            if (!url) return;

            const match = url.match(/github\.com\/([^\/]+)\/([^\/]+)/);
            if (!match) {
                alert('올바른 GitHub URL을 입력하세요');
                return;
            }

            const owner = match[1];
            const repo = match[2].replace('.git', '');
            const repoId = `${owner}/${repo}`;

            if (repositories.find(r => r.id === repoId)) {
                alert('이미 추가된 레포지터리입니다');
                return;
            }

            const repository = {
                id: repoId,
                owner: owner,
                name: repo,
                url: url,
                commits: [],
                files: []
            };

            repositories.push(repository);
            document.getElementById('repoUrl').value = '';
            
            renderTabs();
            loadRepository(repository);
        }

        function renderTabs() {
            const tabsContainer = document.getElementById('tabs');
            tabsContainer.innerHTML = '';

            repositories.forEach(repo => {
                const tab = document.createElement('div');
                tab.style.cssText = `
                    padding: 10px 15px;
                    background: ${activeRepo?.id === repo.id ? '#667eea' : '#f8f9fa'};
                    color: ${activeRepo?.id === repo.id ? 'white' : '#333'};
                    border-radius: 6px 6px 0 0;
                    cursor: pointer;
                    margin-right: 5px;
                    display: inline-flex;
                    align-items: center;
                `;
                tab.innerHTML = `
                    <span onclick="selectRepository('${repo.id}')">${repo.name}</span>
                    <span onclick="removeRepository('${repo.id}')" style="margin-left: 10px; color: #999; font-weight: bold; cursor: pointer;">&times;</span>
                `;
                tabsContainer.appendChild(tab);
            });
        }

        function selectRepository(repoId) {
            activeRepo = repositories.find(r => r.id === repoId);
            renderTabs();
            renderRepository();
        }

        function removeRepository(repoId) {
            repositories = repositories.filter(r => r.id !== repoId);
            if (activeRepo?.id === repoId) {
                activeRepo = repositories[0] || null;
            }
            renderTabs();
            if (activeRepo) {
                renderRepository();
            } else {
                document.getElementById('content').innerHTML = '<div style="text-align: center; padding: 50px; color: #666;">레포지터리를 추가하여 분석을 시작하세요</div>';
            }
        }

        async function loadRepository(repository) {
            activeRepo = repository;
            renderTabs();
            
            document.getElementById('content').innerHTML = '<div style="text-align: center; padding: 50px; color: #666;">레포지터리 정보를 로딩 중...</div>';

            try {
                const repoResponse = await fetch(`/api/github/repos/${repository.id}`);
                const repoData = await repoResponse.json();

                const commitsResponse = await fetch(`/api/github/repos/${repository.id}/commits?per_page=50`);
                const commitsData = await commitsResponse.json();

                repository.info = repoData;
                repository.commits = commitsData;

                renderRepository();
                renderNetworkGraph();
            } catch (error) {
                document.getElementById('content').innerHTML = `<div style="color: #ff4444; background: #fff5f5; padding: 15px; border-radius: 6px;">레포지터리 로딩 실패: ${error.message}</div>`;
            }
        }

        function renderRepository() {
            if (!activeRepo) return;

            const content = document.getElementById('content');
            content.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 6px;">
                        <h3 style="color: #333; margin-bottom: 10px;">📊 레포지터리 정보</h3>
                        <p><strong>이름:</strong> ${activeRepo.info?.name || activeRepo.name}</p>
                        <p><strong>설명:</strong> ${activeRepo.info?.description || '설명 없음'}</p>
                        <p><strong>언어:</strong> ${activeRepo.info?.language || '알 수 없음'}</p>
                        <p><strong>스타:</strong> ${activeRepo.info?.stargazers_count || 0}</p>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 6px;">
                        <h3 style="color: #333; margin-bottom: 10px;">📈 통계</h3>
                        <p><strong>커밋 수:</strong> ${activeRepo.commits?.length || 0}</p>
                        <p><strong>브랜치:</strong> ${activeRepo.info?.default_branch || 'main'}</p>
                        <p><strong>생성일:</strong> ${activeRepo.info?.created_at ? new Date(activeRepo.info.created_at).toLocaleDateString() : '알 수 없음'}</p>
                        <p><strong>마지막 업데이트:</strong> ${activeRepo.info?.updated_at ? new Date(activeRepo.info.updated_at).toLocaleDateString() : '알 수 없음'}</p>
                    </div>
                </div>
                
                <h3 style="color: #333; margin-bottom: 15px;">🌐 커밋 네트워크 그래프</h3>
                <div id="networkGraph" style="width: 100%; height: 400px; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 20px;"></div>
                
                <div id="commitDetails" style="background: #f8f9fa; padding: 15px; border-radius: 6px; display: none;">
                    <h3 style="color: #333; margin-bottom: 10px;">📝 커밋 상세 정보</h3>
                    <div id="commitInfo"></div>
                    <div id="codeDiff" style="margin-top: 15px;"></div>
                </div>
            `;

            renderNetworkGraph();
        }

        function renderNetworkGraph() {
            if (!activeRepo?.commits) return;

            const container = document.getElementById('networkGraph');
            if (!container) return;

            container.innerHTML = '';

            const width = container.clientWidth;
            const height = 400;

            const svg = d3.select('#networkGraph')
                .append('svg')
                .attr('width', width)
                .attr('height', height);

            const commits = activeRepo.commits.slice(0, 20);

            const xScale = d3.scaleTime()
                .domain(d3.extent(commits, d => new Date(d.commit.author.date)))
                .range([50, width - 50]);

            svg.selectAll('.commit-node')
                .data(commits)
                .enter()
                .append('circle')
                .attr('class', 'commit-node')
                .attr('cx', d => xScale(new Date(d.commit.author.date)))
                .attr('cy', height / 2)
                .attr('r', 8)
                .attr('fill', '#667eea')
                .attr('stroke', '#fff')
                .attr('stroke-width', 2)
                .style('cursor', 'pointer')
                .on('click', (event, d) => showCommitDetails(d))
                .on('mouseover', function(event, d) {
                    d3.select(this).attr('r', 12);
                })
                .on('mouseout', function() {
                    d3.select(this).attr('r', 8);
                });

            for (let i = 0; i < commits.length - 1; i++) {
                svg.append('line')
                    .attr('x1', xScale(new Date(commits[i].commit.author.date)))
                    .attr('y1', height / 2)
                    .attr('x2', xScale(new Date(commits[i + 1].commit.author.date)))
                    .attr('y2', height / 2)
                    .attr('stroke', '#ddd')
                    .attr('stroke-width', 2);
            }

            const xAxis = d3.axisBottom(xScale).tickFormat(d3.timeFormat('%m/%d'));
            svg.append('g')
                .attr('transform', `translate(0, ${height - 30})`)
                .call(xAxis);
        }

        async function showCommitDetails(commit) {
            const detailsContainer = document.getElementById('commitDetails');
            const commitInfo = document.getElementById('commitInfo');
            const codeDiff = document.getElementById('codeDiff');

            detailsContainer.style.display = 'block';

            commitInfo.innerHTML = `
                <p><strong>커밋:</strong> ${commit.sha.substring(0, 8)}</p>
                <p><strong>메시지:</strong> ${commit.commit.message}</p>
                <p><strong>작성자:</strong> ${commit.commit.author.name}</p>
                <p><strong>날짜:</strong> ${new Date(commit.commit.author.date).toLocaleString()}</p>
            `;

            codeDiff.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">코드 변경사항을 로딩 중...</div>';

            try {
                const diffResponse = await fetch(`/api/github/repos/${activeRepo.id}/commits/${commit.sha}`);
                const diffData = await diffResponse.json();

                let diffHtml = '';
                if (diffData.files && diffData.files.length > 0) {
                    diffData.files.slice(0, 3).forEach(file => {
                        diffHtml += `
                            <div style="background: white; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 10px;">
                                <h4 style="background: #f1f3f4; padding: 10px; margin: 0; border-bottom: 1px solid #ddd;">📄 ${file.filename}</h4>
                                <pre style="padding: 15px; margin: 0; overflow-x: auto; font-size: 12px; line-height: 1.4;">${file.patch || '변경사항 없음'}</pre>
                            </div>
                        `;
                    });
                } else {
                    diffHtml = '<div style="background: white; border: 1px solid #ddd; border-radius: 4px; padding: 15px;">변경사항 없음</div>';
                }

                codeDiff.innerHTML = diffHtml;
            } catch (error) {
                codeDiff.innerHTML = `<div style="color: #ff4444; background: #fff5f5; padding: 15px; border-radius: 6px;">코드 변경사항 로딩 실패: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>
